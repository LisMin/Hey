/**
 * Created by ll on 2017/3/6.
 */
var HEY;
(function (HEY) {
    var vertices = new Float32Array([
        -0.5, -0.5, -0.5, 0.0, 0.0,
        0.5, -0.5, -0.5, 1.0, 0.0,
        0.5, 0.5, -0.5, 1.0, 1.0,
        0.5, 0.5, -0.5, 1.0, 1.0,
        -0.5, 0.5, -0.5, 0.0, 1.0,
        -0.5, -0.5, -0.5, 0.0, 0.0,
        -0.5, -0.5, 0.5, 0.0, 0.0,
        0.5, -0.5, 0.5, 1.0, 0.0,
        0.5, 0.5, 0.5, 1.0, 1.0,
        0.5, 0.5, 0.5, 1.0, 1.0,
        -0.5, 0.5, 0.5, 0.0, 1.0,
        -0.5, -0.5, 0.5, 0.0, 0.0,
        -0.5, 0.5, 0.5, 1.0, 0.0,
        -0.5, 0.5, -0.5, 1.0, 1.0,
        -0.5, -0.5, -0.5, 0.0, 1.0,
        -0.5, -0.5, -0.5, 0.0, 1.0,
        -0.5, -0.5, 0.5, 0.0, 0.0,
        -0.5, 0.5, 0.5, 1.0, 0.0,
        0.5, 0.5, 0.5, 1.0, 0.0,
        0.5, 0.5, -0.5, 1.0, 1.0,
        0.5, -0.5, -0.5, 0.0, 1.0,
        0.5, -0.5, -0.5, 0.0, 1.0,
        0.5, -0.5, 0.5, 0.0, 0.0,
        0.5, 0.5, 0.5, 1.0, 0.0,
        -0.5, -0.5, -0.5, 0.0, 1.0,
        0.5, -0.5, -0.5, 1.0, 1.0,
        0.5, -0.5, 0.5, 1.0, 0.0,
        0.5, -0.5, 0.5, 1.0, 0.0,
        -0.5, -0.5, 0.5, 0.0, 0.0,
        -0.5, -0.5, -0.5, 0.0, 1.0,
        -0.5, 0.5, -0.5, 0.0, 1.0,
        0.5, 0.5, -0.5, 1.0, 1.0,
        0.5, 0.5, 0.5, 1.0, 0.0,
        0.5, 0.5, 0.5, 1.0, 0.0,
        -0.5, 0.5, 0.5, 0.0, 0.0,
        -0.5, 0.5, -0.5, 0.0, 1.0
    ]);
    var Box = (function () {
        function Box() {
            this.webgl_texture = null;
            this.program = null;
            this.vao = null;
            this.loc_texture = -1;
            this.loc_model = -1;
            this.loc_view = -1;
            this.loc_projection = -1;
            this.deltaX = 0;
            this.initVAO();
            this.initTextures();
            this.initProgram();
        }
        Box.prototype.initVAO = function () {
            var gl = HEY.Scene.gl;
            var vao = gl.createVertexArray();
            var vbo = gl.createBuffer();
            gl.bindVertexArray(vao);
            gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
            gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
            gl.vertexAttribPointer(0, 3, gl.FLOAT, false, 5 * 4, 0);
            gl.enableVertexAttribArray(0);
            gl.vertexAttribPointer(1, 2, gl.FLOAT, false, 2 * 4, 3 * 4);
            gl.enableVertexAttribArray(1);
            gl.bindVertexArray(null);
            gl.bindBuffer(gl.ARRAY_BUFFER, null);
            this.vao = vao;
        };
        Box.prototype.initTextures = function () {
            var gl = HEY.Scene.gl;
            var texture = gl.createTexture();
            gl.bindTexture(gl.TEXTURE_2D, texture);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
            var data = new Uint8Array([255, 0, 255, 255]);
            var image = document.createElement("img");
            image.src = "../asset/wall.jpg";
            image.onload = function (data) {
                gl.bindTexture(gl.TEXTURE_2D, texture);
                gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, data.target);
                gl.generateMipmap(gl.TEXTURE_2D);
            };
            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, data);
            gl.generateMipmap(gl.TEXTURE_2D);
            gl.bindTexture(gl.TEXTURE_2D, null);
            this.webgl_texture = texture;
        };
        Box.prototype.initProgram = function () {
            var gl = HEY.Scene.gl;
            var shader = new HEY.Shader(HEY.ShaderLib.v_box, HEY.ShaderLib.f_box);
            this.program = shader.getWebglProgram();
            this.loc_texture = gl.getUniformLocation(this.program, "ourTexture");
            this.loc_model = gl.getUniformLocation(this.program, "model");
            this.loc_view = gl.getUniformLocation(this.program, "view");
            this.loc_projection = gl.getUniformLocation(this.program, "projection");
        };
        Box.prototype.render = function () {
            var gl = HEY.Scene.gl;
            gl.useProgram(this.program);
            this.deltaX += 0.01;
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, this.webgl_texture);
            gl.uniform1i(this.loc_texture, 0);
            var model_matrix = new THREE.Matrix4();
            model_matrix.makeScale(50, 50, 50);
            var rotate_matrix = new THREE.Matrix4();
            rotate_matrix.makeRotationX(this.deltaX);
            gl.uniformMatrix4fv(this.loc_model, false, model_matrix.multiply(rotate_matrix).elements);
            var view_matrix = new THREE.Matrix4();
            view_matrix.makeTranslation(0, 0, -200);
            gl.uniformMatrix4fv(this.loc_view, false, view_matrix.elements);
            var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            var projection_matrix = camera.projectionMatrix;
            gl.uniformMatrix4fv(this.loc_projection, false, projection_matrix.elements);
            gl.bindVertexArray(this.vao);
            gl.drawArrays(gl.TRIANGLES, 0, 36);
            gl.bindVertexArray(null);
            gl.bindTexture(gl.TEXTURE_2D, null);
        };
        return Box;
    }());
    HEY.Box = Box;
})(HEY || (HEY = {}));
/**
 * Created by ll on 2017/3/1.
 */
/// <reference path = "../node_modules/@types/three/index.d.ts" />
var HEY;
(function (HEY) {
    var Rectangle = (function () {
        function Rectangle() {
            this.program = null;
            this.vao = null;
            this.texture = null;
            this.gl = null;
            this.transform = null;
            this.deltaX = 0;
            this.loc_model = -1;
            this.loc_view = -1;
            this.loc_projection = -1;
            this.loc_texture = -1;
            var gl = HEY.Scene.gl;
            var vertices = new Float32Array([
                //position     //colors        //uvs
                -20, 20, 0, 100.0, 0., 0., 0., 1.,
                -20, -20, 0, 0., 100., 0., 0., 0.,
                20, 20, 0, 0., 0., 1., 1., 1.,
                20, -20, 0, 100., 100., 0., 1., 0.,
                -20, 20, 40, 100.0, 0., 0., 0., 1.,
                -20, -20, 40, 0., 100., 0., 0., 0.,
                20, 20, 40, 0., 0., 1., 1., 1.,
                20, -20, 40, 100., 100., 0., 1., 0.,
            ]);
            var indices = new Uint16Array([
                0, 1, 2,
                2, 1, 3,
                4, 5, 7,
                4, 7, 6,
                4, 1, 5,
                0, 1, 4,
                6, 7, 3,
                2, 6, 3,
                2, 0, 4,
                2, 4, 6,
                1, 5, 7,
                1, 7, 3
            ]);
            var ebo = gl.createBuffer();
            var vbo = gl.createBuffer();
            var vao = gl.createVertexArray();
            gl.bindVertexArray(vao);
            gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
            gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ebo);
            gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);
            gl.vertexAttribPointer(0, 3, gl.FLOAT, false, 8 * Float32Array.BYTES_PER_ELEMENT, 0);
            gl.enableVertexAttribArray(0);
            gl.vertexAttribPointer(1, 3, gl.FLOAT, false, 8 * Float32Array.BYTES_PER_ELEMENT, 3 * Float32Array.BYTES_PER_ELEMENT);
            gl.enableVertexAttribArray(1);
            gl.vertexAttribPointer(2, 2, gl.FLOAT, false, 8 * Float32Array.BYTES_PER_ELEMENT, 6 * Float32Array.BYTES_PER_ELEMENT);
            gl.enableVertexAttribArray(2);
            gl.bindVertexArray(null);
            gl.bindBuffer(gl.ARRAY_BUFFER, null);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);
            //init textures
            var texture = gl.createTexture();
            gl.bindTexture(gl.TEXTURE_2D, texture);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
            var data = new Uint8Array([255, 0, 255, 255]);
            var image = document.createElement("img");
            image.src = "../asset/wall.jpg";
            image.onload = function (data) {
                gl.bindTexture(gl.TEXTURE_2D, texture);
                gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, data.target);
            };
            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, data);
            gl.generateMipmap(gl.TEXTURE_2D);
            gl.bindTexture(gl.TEXTURE_2D, null);
            this.texture = texture;
            var shader = new HEY.Shader(HEY.ShaderLib.v_rectangle, HEY.ShaderLib.f_rectangle);
            this.program = shader.getWebglProgram();
            this.vao = vao;
            this.gl = gl;
            this.transform = new THREE.Matrix4();
            this.loc_model = gl.getUniformLocation(this.program, "model");
            this.loc_view = gl.getUniformLocation(this.program, "view");
            this.loc_projection = gl.getUniformLocation(this.program, "projection");
            this.loc_texture = gl.getUniformLocation(this.program, "ourTexture");
        }
        Rectangle.prototype.render = function () {
            var gl = this.gl;
            gl.useProgram(this.program);
            gl.activeTexture(gl.TEXTURE1);
            gl.bindTexture(gl.TEXTURE_2D, this.texture);
            var loc = this.loc_texture;
            gl.uniform1i(loc, 1);
            this.deltaX += 0.01;
            this.transform.makeRotationX(this.deltaX);
            var loc_transform = this.loc_model;
            gl.uniformMatrix4fv(loc_transform, false, this.transform.elements);
            var viewMatrix = new THREE.Matrix4();
            viewMatrix.makeTranslation(0, 0, -100);
            gl.uniformMatrix4fv(this.loc_view, false, viewMatrix.elements);
            var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            var projectionMatrix = camera.projectionMatrix;
            gl.uniformMatrix4fv(this.loc_projection, false, projectionMatrix.elements);
            gl.bindVertexArray(this.vao);
            gl.drawElements(gl.TRIANGLES, 36, gl.UNSIGNED_SHORT, 0);
            gl.bindVertexArray(null);
        };
        return Rectangle;
    }());
    HEY.Rectangle = Rectangle;
})(HEY || (HEY = {}));
/**
 * Created by hey on 2017/2/28.
 */
var HEY;
(function (HEY) {
    var WebGL2Renderer = (function () {
        function WebGL2Renderer(parameters) {
            if (parameters === void 0) { parameters = null; }
            this.gl = null;
            parameters = parameters || {};
            var _canvas = parameters.canvas !== undefined ? parameters.canvas : document.createElementNS('http://www.w3.org/1999/xhtml', 'canvas'), _context = parameters.context !== undefined ? parameters.context : null, _alpha = parameters.alpha !== undefined ? parameters.alpha : false, _depth = parameters.depth !== undefined ? parameters.depth : true, _stencil = parameters.stencil !== undefined ? parameters.stencil : true, _antialias = parameters.antialias !== undefined ? parameters.antialias : false, _premultipliedAlpha = parameters.premultipliedAlpha !== undefined ? parameters.premultipliedAlpha : true, _preserveDrawingBuffer = parameters.preserveDrawingBuffer !== undefined ? parameters.preserveDrawingBuffer : false;
            // initialize
            var gl;
            try {
                var attributes = {
                    alpha: _alpha,
                    depth: _depth,
                    stencil: _stencil,
                    antialias: _antialias,
                    premultipliedAlpha: _premultipliedAlpha,
                    preserveDrawingBuffer: _preserveDrawingBuffer
                };
                gl = _context || _canvas.getContext('webgl2', attributes);
                if (gl === null) {
                    if (_canvas.getContext('webgl2') !== null) {
                        throw 'Error creating WebGL2 context with your selected attributes.';
                    }
                    else {
                        throw 'Error creating WebGL2 context.';
                    }
                }
                _canvas.addEventListener('webglcontextlost', function (event) {
                    event.preventDefault();
                }, false);
            }
            catch (error) {
                console.error('THREE.WebGL2Renderer: ' + error);
            }
            this.gl = gl;
        }
        return WebGL2Renderer;
    }());
    HEY.WebGL2Renderer = WebGL2Renderer;
})(HEY || (HEY = {}));
/**
 * Created by ll on 2017/3/1.
 */
///<reference path="./WebGL2Renderer.ts" />
var HEY;
(function (HEY) {
    var Scene;
    (function (Scene) {
        Scene.gl = null;
        var triangle = null;
        var rectangle = null;
        var box = null;
        function init() {
            var canvas = document.getElementById("render_canvas");
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            var renderer = new HEY.WebGL2Renderer({ canvas: canvas });
            Scene.gl = renderer.gl;
            rectangle = new HEY.Rectangle();
            triangle = new HEY.Triangle();
            box = new HEY.Box();
        }
        Scene.init = init;
        function render() {
            Scene.gl.enable(Scene.gl.DEPTH_TEST);
            Scene.gl.clearColor(1, 1, 1, 1);
            Scene.gl.clear(Scene.gl.COLOR_BUFFER_BIT | Scene.gl.DEPTH_BUFFER_BIT);
            // triangle.render();
            // rectangle.render();
            box.render();
        }
        Scene.render = render;
    })(Scene = HEY.Scene || (HEY.Scene = {}));
})(HEY || (HEY = {}));
/**
 * Created by ll on 2017/3/1.
 */
var HEY;
(function (HEY) {
    var Shader = (function () {
        function Shader(v, f) {
            this.program = null;
            var gl = HEY.Scene.gl;
            var vertexShader = gl.createShader(gl.VERTEX_SHADER);
            gl.shaderSource(vertexShader, v);
            gl.compileShader(vertexShader);
            var succ = gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS);
            if (!succ) {
                var log = gl.getShaderInfoLog(vertexShader);
                console.log("compile shader error:", log);
                return;
            }
            var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
            gl.shaderSource(fragmentShader, f);
            gl.compileShader(fragmentShader);
            succ = gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS);
            if (!succ) {
                var log = gl.getShaderInfoLog(fragmentShader);
                console.log(log);
                return;
            }
            var program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);
            gl.deleteShader(vertexShader);
            gl.deleteShader(fragmentShader);
            succ = gl.getProgramParameter(program, gl.LINK_STATUS);
            if (!succ) {
                var log = gl.getProgramInfoLog(program);
                console.log(log);
                return;
            }
            this.program = program;
        }
        Shader.prototype.getWebglProgram = function () {
            return this.program;
        };
        return Shader;
    }());
    HEY.Shader = Shader;
})(HEY || (HEY = {}));
/**
 * Created by hey on 2017/2/28.
 */
var HEY;
(function (HEY) {
    var ShaderLib;
    (function (ShaderLib) {
        ShaderLib.v_default = "#version 300 es\n            layout (location = 0) in vec3 position;\n            void main()\n            {\n                 gl_Position = vec4(position.x, position.y, position.z, 1.0);\n            }\n        ";
        ShaderLib.f_default = "#version 300 es\n            precision highp float;\n            out vec4 color;\n            \n            void main()\n            {\n                color = vec4(1.0f, 0.5f, 0.2f, 1.0f);\n            }\n    ";
        ShaderLib.v_rectangle = "#version 300 es\n         layout (location = 0) in vec3 position;\n         layout (location = 1) in vec3 color;\n         layout (location = 2) in vec2 uv;\n         \n         uniform mat4 model;\n         uniform mat4 view;\n         uniform mat4 projection;\n                  \n         out vec3 ourColor;\n         out vec2 texCoord;\n         void main(){\n            gl_Position = projection*view*model*vec4(position,1.);\n            ourColor = vec3(color);\n            texCoord = uv;\n         }\n        ";
        ShaderLib.f_rectangle = "#version 300 es\n            precision highp float;\n            out vec4 color;\n            \n            in vec3 ourColor;\n            in vec2 texCoord;\n            \n            uniform sampler2D ourTexture; \n            \n            void main()\n            {\n                color = vec4(ourColor, 1.0f);\n                color = texture(ourTexture,texCoord);\n            }\n\n        ";
        ShaderLib.v_box = "#version 300 es\n         \n         layout(location = 0) in vec3 position;   \n         layout(location = 1) in vec2 uv;\n         \n         uniform mat4 model;\n         uniform mat4 view;\n         uniform mat4 projection;\n                  \n         out vec2 texCoord;\n         void main(){\n            gl_Position = projection*view*model*vec4(position,1.);\n            texCoord = uv;\n         }\n        ";
        ShaderLib.f_box = "#version 300 es\n            precision highp float;\n            out vec4 color;\n            \n            in vec2 texCoord;\n            \n            uniform sampler2D ourTexture; \n            \n            void main()\n            {\n                color = texture(ourTexture,texCoord);\n            }\n\n        ";
    })(ShaderLib = HEY.ShaderLib || (HEY.ShaderLib = {}));
})(HEY || (HEY = {}));
/**
 * Created by hey on 2017/2/28.
 */
var HEY;
(function (HEY) {
    var Triangle = (function () {
        function Triangle() {
            this.program = null;
            this.vao = null;
            var vao = null;
            var program = null;
            var vertices = new Float32Array([
                -0.5, -0.5, 0.0,
                0.5, -0.5, 0.0,
                0.0, 0.5, 0.0
            ]);
            var gl = HEY.Scene.gl;
            var vertexShader = gl.createShader(gl.VERTEX_SHADER);
            gl.shaderSource(vertexShader, HEY.ShaderLib.v_default);
            gl.compileShader(vertexShader);
            var succ = gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS);
            if (!succ) {
                var log = gl.getShaderInfoLog(vertexShader);
                console.log("compile shader error:", log);
                return;
            }
            var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
            gl.shaderSource(fragmentShader, HEY.ShaderLib.f_default);
            gl.compileShader(fragmentShader);
            succ = gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS);
            if (!succ) {
                var log = gl.getShaderInfoLog(fragmentShader);
                console.log(log);
                return;
            }
            program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);
            succ = gl.getProgramParameter(program, gl.LINK_STATUS);
            if (!succ) {
                var log = gl.getProgramInfoLog(program);
                console.log(log);
                return;
            }
            gl.deleteShader(vertexShader);
            gl.deleteShader(fragmentShader);
            vao = gl.createVertexArray();
            gl.bindVertexArray(vao);
            var buffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
            gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
            gl.vertexAttribPointer(0, 3, gl.FLOAT, false, 0, 0);
            gl.enableVertexAttribArray(0);
            gl.bindVertexArray(null);
            this.program = program;
            this.vao = vao;
        }
        Triangle.prototype.render = function () {
            var gl = HEY.Scene.gl;
            gl.bindVertexArray(this.vao);
            gl.useProgram(this.program);
            gl.drawArrays(gl.TRIANGLES, 0, 3);
            gl.bindVertexArray(null);
        };
        return Triangle;
    }());
    HEY.Triangle = Triangle;
})(HEY || (HEY = {}));
//# sourceMappingURL=bundle.min.js.map